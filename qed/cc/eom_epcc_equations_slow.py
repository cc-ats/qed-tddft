# the slow code is in eom_epcc_equations.
#this version is not used!!!

import numpy
from cqcpy import cc_equations
from . import epcc_energy

einsum = numpy.einsum
#from pyscf import lib
#einsum = lib.einsum

def eom_ee_epccsd_n_sn_sigma_slow(nfock1, nfock2, RS, RD, 
        Rn, RSn, amps, F, I, w, g, h, G, H, imds=None):
    
    # start of the copy of eom_ee_epccsd_1_s1_sigma_opt (with minor modification)
    T1,T2,Sn,U1n = amps

    nm,nv,no = U1n[0].shape

    amps_s1_U11 = (T1, T2, Sn[0], U1n[0]) # Create small amps
    if imds is None:
        imds = EEImds() # extend it for general nfock
        imds.build(amps_s1_U11, F, I, w, g, h, G, H)

    sigS = numpy.zeros(T1.shape)
    sigD = numpy.zeros(T2.shape)
    
    sign = [None] * nfock1
    for k in range(nfock1):
        sign[k] = numpy.zeros(Sn[k].shape)

    sigSn = [None] * nfock2

    for k in range(nfock2):
        sigSn[k] = numpy.zeros(U1n[k].shape)

    # Define individual variables to match code generator
    sig1 = sign[0]
    sigS1 = sigSn[0]
    R1 = Rn[0]
    RS1 = RSn[0]
    S1 = Sn[0]
    U11 = U1n[0]

    if ( nfock1 > 1 ):
        R2 = Rn[1]
        S2 = Sn[1]
    if ( nfock1 > 2 ):
        R3 = Rn[2]
        S3 = Sn[2]
    if ( nfock1 > 3 ):
        R4 = Rn[3]
        S4 = Sn[3]
    if ( nfock1 > 4 ):
        R5 = Rn[4]
        S5 = Sn[4]
    if ( nfock1 > 5 ):
        assert(False), "nfock1 >= 6 not yet implemented."

    if ( nfock2 > 1 ):
        assert(False), "nfock2 >= 2 not yet implemented."

    sigS += -1.0*einsum('ji,aj->ai', F.oo, RS)
    sigS += 1.0*einsum('ab,bi->ai', F.vv, RS)
    sigS += 1.0*einsum('I,Iai->ai', G, RS1)
    sigS += 1.0*einsum('Iai,I->ai', g.vo, R1)
    sigS += -1.0*einsum('jb,abji->ai', F.ov, RD)
    sigS += -1.0*einsum('ajbi,bj->ai', I.vovo, RS)
    sigS += -1.0*einsum('Iji,Iaj->ai', g.oo, RS1)
    sigS += 1.0*einsum('Iab,Ibi->ai', g.vv, RS1)
    sigS += 0.5*einsum('jkib,abkj->ai', I.ooov, RD)
    sigS += 0.5*einsum('ajbc,cbji->ai', I.vovv, RD)
    sigS += -1.0*einsum('jb,bi,aj->ai', F.ov, T1, RS)
    sigS += -1.0*einsum('jb,aj,bi->ai', F.ov, T1, RS)
    sigS += -1.0*einsum('Iji,aj,I->ai', g.oo, T1, R1)
    sigS += -1.0*einsum('Iji,I,aj->ai', g.oo, S1, RS)
    sigS += 1.0*einsum('Iab,bi,I->ai', g.vv, T1, R1)
    sigS += 1.0*einsum('Iab,I,bi->ai', g.vv, S1, RS)
    sigS += -1.0*einsum('jkib,aj,bk->ai', I.ooov, T1, RS)
    sigS += 1.0*einsum('jkib,bj,ak->ai', I.ooov, T1, RS)
    sigS += -1.0*einsum('ajbc,ci,bj->ai', I.vovv, T1, RS)
    sigS += 1.0*einsum('ajbc,cj,bi->ai', I.vovv, T1, RS)
    sigS += -1.0*einsum('Ijb,bi,Iaj->ai', g.ov, T1, RS1)
    sigS += -1.0*einsum('Ijb,aj,Ibi->ai', g.ov, T1, RS1)
    sigS += 1.0*einsum('Ijb,bj,Iai->ai', g.ov, T1, RS1)
    sigS += -1.0*einsum('Ijb,abji,I->ai', g.ov, T2, R1)
    sigS += -1.0*einsum('Ijb,I,abji->ai', g.ov, S1, RD)
    sigS += 1.0*einsum('Ijb,Iai,bj->ai', g.ov, U11, RS)
    sigS += -1.0*einsum('Ijb,Ibi,aj->ai', g.ov, U11, RS)
    sigS += -1.0*einsum('Ijb,Iaj,bi->ai', g.ov, U11, RS)
    sigS += -0.5*einsum('jkbc,ci,abkj->ai', I.oovv, T1, RD)
    sigS += -0.5*einsum('jkbc,aj,cbki->ai', I.oovv, T1, RD)
    sigS += 1.0*einsum('jkbc,cj,abki->ai', I.oovv, T1, RD)
    sigS += 1.0*einsum('jkbc,acji,bk->ai', I.oovv, T2, RS)
    sigS += 0.5*einsum('jkbc,cbji,ak->ai', I.oovv, T2, RS)
    sigS += 0.5*einsum('jkbc,ackj,bi->ai', I.oovv, T2, RS)
    sigS += -1.0*einsum('Ijb,bi,aj,I->ai', g.ov, T1, T1, R1)
    sigS += -1.0*einsum('Ijb,bi,I,aj->ai', g.ov, T1, S1, RS)
    sigS += -1.0*einsum('Ijb,aj,I,bi->ai', g.ov, T1, S1, RS)
    sigS += 1.0*einsum('jkbc,ci,aj,bk->ai', I.oovv, T1, T1, RS)
    sigS += -1.0*einsum('jkbc,ci,bj,ak->ai', I.oovv, T1, T1, RS)
    sigS += -1.0*einsum('jkbc,aj,ck,bi->ai', I.oovv, T1, T1, RS)

    sigD += 1.0*einsum('ki,bakj->abij', F.oo, RD)
    sigD += -1.0*einsum('kj,baki->abij', F.oo, RD)
    sigD += -1.0*einsum('bc,acji->abij', F.vv, RD)
    sigD += 1.0*einsum('ac,bcji->abij', F.vv, RD)
    sigD += -1.0*einsum('bkji,ak->abij', I.vooo, RS)
    sigD += 1.0*einsum('akji,bk->abij', I.vooo, RS)
    sigD += 1.0*einsum('baci,cj->abij', I.vvvo, RS)
    sigD += -1.0*einsum('bacj,ci->abij', I.vvvo, RS)
    sigD += -1.0*einsum('Ibi,Iaj->abij', g.vo, RS1)
    sigD += 1.0*einsum('Iai,Ibj->abij', g.vo, RS1)
    sigD += 1.0*einsum('Ibj,Iai->abij', g.vo, RS1)
    sigD += -1.0*einsum('Iaj,Ibi->abij', g.vo, RS1)
    sigD += -0.5*einsum('klji,balk->abij', I.oooo, RD)
    sigD += -1.0*einsum('bkci,ackj->abij', I.vovo, RD)
    sigD += 1.0*einsum('akci,bckj->abij', I.vovo, RD)
    sigD += 1.0*einsum('bkcj,acki->abij', I.vovo, RD)
    sigD += -1.0*einsum('akcj,bcki->abij', I.vovo, RD)
    sigD += -0.5*einsum('bacd,dcji->abij', I.vvvv, RD)
    sigD += 1.0*einsum('kc,ci,bakj->abij', F.ov, T1, RD)
    sigD += -1.0*einsum('kc,cj,baki->abij', F.ov, T1, RD)
    sigD += 1.0*einsum('kc,bk,acji->abij', F.ov, T1, RD)
    sigD += -1.0*einsum('kc,ak,bcji->abij', F.ov, T1, RD)
    sigD += -1.0*einsum('kc,bcji,ak->abij', F.ov, T2, RS)
    sigD += 1.0*einsum('kc,acji,bk->abij', F.ov, T2, RS)
    sigD += -1.0*einsum('kc,baki,cj->abij', F.ov, T2, RS)
    sigD += 1.0*einsum('kc,bakj,ci->abij', F.ov, T2, RS)
    sigD += 1.0*einsum('klji,bk,al->abij', I.oooo, T1, RS)
    sigD += -1.0*einsum('klji,ak,bl->abij', I.oooo, T1, RS)
    sigD += -1.0*einsum('bkci,cj,ak->abij', I.vovo, T1, RS)
    sigD += 1.0*einsum('akci,cj,bk->abij', I.vovo, T1, RS)
    sigD += -1.0*einsum('bkci,ak,cj->abij', I.vovo, T1, RS)
    sigD += 1.0*einsum('akci,bk,cj->abij', I.vovo, T1, RS)
    sigD += 1.0*einsum('bkcj,ci,ak->abij', I.vovo, T1, RS)
    sigD += -1.0*einsum('akcj,ci,bk->abij', I.vovo, T1, RS)
    sigD += 1.0*einsum('bkcj,ak,ci->abij', I.vovo, T1, RS)
    sigD += -1.0*einsum('akcj,bk,ci->abij', I.vovo, T1, RS)
    sigD += 1.0*einsum('bacd,di,cj->abij', I.vvvv, T1, RS)
    sigD += -1.0*einsum('bacd,dj,ci->abij', I.vvvv, T1, RS)
    sigD += 1.0*einsum('Iki,bk,Iaj->abij', g.oo, T1, RS1)
    sigD += -1.0*einsum('Iki,ak,Ibj->abij', g.oo, T1, RS1)
    sigD += -1.0*einsum('Ikj,bk,Iai->abij', g.oo, T1, RS1)
    sigD += 1.0*einsum('Ikj,ak,Ibi->abij', g.oo, T1, RS1)
    sigD += 1.0*einsum('Iki,bakj,I->abij', g.oo, T2, R1)
    sigD += -1.0*einsum('Ikj,baki,I->abij', g.oo, T2, R1)
    sigD += 1.0*einsum('Iki,I,bakj->abij', g.oo, S1, RD)
    sigD += -1.0*einsum('Ikj,I,baki->abij', g.oo, S1, RD)
    sigD += -1.0*einsum('Iki,Ibj,ak->abij', g.oo, U11, RS)
    sigD += 1.0*einsum('Iki,Iaj,bk->abij', g.oo, U11, RS)
    sigD += 1.0*einsum('Ikj,Ibi,ak->abij', g.oo, U11, RS)
    sigD += -1.0*einsum('Ikj,Iai,bk->abij', g.oo, U11, RS)
    sigD += -1.0*einsum('Ibc,ci,Iaj->abij', g.vv, T1, RS1)
    sigD += 1.0*einsum('Iac,ci,Ibj->abij', g.vv, T1, RS1)
    sigD += 1.0*einsum('Ibc,cj,Iai->abij', g.vv, T1, RS1)
    sigD += -1.0*einsum('Iac,cj,Ibi->abij', g.vv, T1, RS1)
    sigD += -1.0*einsum('Ibc,acji,I->abij', g.vv, T2, R1)
    sigD += 1.0*einsum('Iac,bcji,I->abij', g.vv, T2, R1)
    sigD += -1.0*einsum('Ibc,I,acji->abij', g.vv, S1, RD)
    sigD += 1.0*einsum('Iac,I,bcji->abij', g.vv, S1, RD)
    sigD += 1.0*einsum('Ibc,Iai,cj->abij', g.vv, U11, RS)
    sigD += -1.0*einsum('Iac,Ibi,cj->abij', g.vv, U11, RS)
    sigD += -1.0*einsum('Ibc,Iaj,ci->abij', g.vv, U11, RS)
    sigD += 1.0*einsum('Iac,Ibj,ci->abij', g.vv, U11, RS)
    sigD += 0.5*einsum('klic,cj,balk->abij', I.ooov, T1, RD)
    sigD += -1.0*einsum('klic,bk,aclj->abij', I.ooov, T1, RD)
    sigD += 1.0*einsum('klic,ak,bclj->abij', I.ooov, T1, RD)
    sigD += -1.0*einsum('klic,ck,balj->abij', I.ooov, T1, RD)
    sigD += -0.5*einsum('kljc,ci,balk->abij', I.ooov, T1, RD)
    sigD += 1.0*einsum('kljc,bk,acli->abij', I.ooov, T1, RD)
    sigD += -1.0*einsum('kljc,ak,bcli->abij', I.ooov, T1, RD)
    sigD += 1.0*einsum('kljc,ck,bali->abij', I.ooov, T1, RD)
    sigD += 1.0*einsum('klic,bakj,cl->abij', I.ooov, T2, RS)
    sigD += -1.0*einsum('klic,bckj,al->abij', I.ooov, T2, RS)
    sigD += 1.0*einsum('klic,ackj,bl->abij', I.ooov, T2, RS)
    sigD += 0.5*einsum('klic,balk,cj->abij', I.ooov, T2, RS)
    sigD += -1.0*einsum('kljc,baki,cl->abij', I.ooov, T2, RS)
    sigD += 1.0*einsum('kljc,bcki,al->abij', I.ooov, T2, RS)
    sigD += -1.0*einsum('kljc,acki,bl->abij', I.ooov, T2, RS)
    sigD += -0.5*einsum('kljc,balk,ci->abij', I.ooov, T2, RS)
    sigD += -1.0*einsum('bkcd,di,ackj->abij', I.vovv, T1, RD)
    sigD += 1.0*einsum('akcd,di,bckj->abij', I.vovv, T1, RD)
    sigD += 1.0*einsum('bkcd,dj,acki->abij', I.vovv, T1, RD)
    sigD += -1.0*einsum('akcd,dj,bcki->abij', I.vovv, T1, RD)
    sigD += 0.5*einsum('bkcd,ak,dcji->abij', I.vovv, T1, RD)
    sigD += -1.0*einsum('bkcd,dk,acji->abij', I.vovv, T1, RD)
    sigD += -0.5*einsum('akcd,bk,dcji->abij', I.vovv, T1, RD)
    sigD += 1.0*einsum('akcd,dk,bcji->abij', I.vovv, T1, RD)
    sigD += 1.0*einsum('bkcd,adji,ck->abij', I.vovv, T2, RS)
    sigD += 0.5*einsum('bkcd,dcji,ak->abij', I.vovv, T2, RS)
    sigD += -1.0*einsum('akcd,bdji,ck->abij', I.vovv, T2, RS)
    sigD += -0.5*einsum('akcd,dcji,bk->abij', I.vovv, T2, RS)
    sigD += -1.0*einsum('bkcd,adki,cj->abij', I.vovv, T2, RS)
    sigD += 1.0*einsum('akcd,bdki,cj->abij', I.vovv, T2, RS)
    sigD += 1.0*einsum('bkcd,adkj,ci->abij', I.vovv, T2, RS)
    sigD += -1.0*einsum('akcd,bdkj,ci->abij', I.vovv, T2, RS)
    sigD += -1.0*einsum('Ikc,bcji,Iak->abij', g.ov, T2, RS1)
    sigD += 1.0*einsum('Ikc,acji,Ibk->abij', g.ov, T2, RS1)
    sigD += -1.0*einsum('Ikc,baki,Icj->abij', g.ov, T2, RS1)
    sigD += 1.0*einsum('Ikc,bcki,Iaj->abij', g.ov, T2, RS1)
    sigD += -1.0*einsum('Ikc,acki,Ibj->abij', g.ov, T2, RS1)
    sigD += 1.0*einsum('Ikc,bakj,Ici->abij', g.ov, T2, RS1)
    sigD += -1.0*einsum('Ikc,bckj,Iai->abij', g.ov, T2, RS1)
    sigD += 1.0*einsum('Ikc,ackj,Ibi->abij', g.ov, T2, RS1)
    sigD += 1.0*einsum('Ikc,Ibi,ackj->abij', g.ov, U11, RD)
    sigD += -1.0*einsum('Ikc,Iai,bckj->abij', g.ov, U11, RD)
    sigD += 1.0*einsum('Ikc,Ici,bakj->abij', g.ov, U11, RD)
    sigD += -1.0*einsum('Ikc,Ibj,acki->abij', g.ov, U11, RD)
    sigD += 1.0*einsum('Ikc,Iaj,bcki->abij', g.ov, U11, RD)
    sigD += -1.0*einsum('Ikc,Icj,baki->abij', g.ov, U11, RD)
    sigD += 1.0*einsum('Ikc,Ibk,acji->abij', g.ov, U11, RD)
    sigD += -1.0*einsum('Ikc,Iak,bcji->abij', g.ov, U11, RD)
    sigD += -0.5*einsum('klcd,bdji,aclk->abij', I.oovv, T2, RD)
    sigD += 0.5*einsum('klcd,adji,bclk->abij', I.oovv, T2, RD)
    sigD += 0.25*einsum('klcd,dcji,balk->abij', I.oovv, T2, RD)
    sigD += -0.5*einsum('klcd,baki,dclj->abij', I.oovv, T2, RD)
    sigD += 1.0*einsum('klcd,bdki,aclj->abij', I.oovv, T2, RD)
    sigD += -1.0*einsum('klcd,adki,bclj->abij', I.oovv, T2, RD)
    sigD += -0.5*einsum('klcd,dcki,balj->abij', I.oovv, T2, RD)
    sigD += 0.5*einsum('klcd,bakj,dcli->abij', I.oovv, T2, RD)
    sigD += -1.0*einsum('klcd,bdkj,acli->abij', I.oovv, T2, RD)
    sigD += 1.0*einsum('klcd,adkj,bcli->abij', I.oovv, T2, RD)
    sigD += 0.5*einsum('klcd,dckj,bali->abij', I.oovv, T2, RD)
    sigD += 0.25*einsum('klcd,balk,dcji->abij', I.oovv, T2, RD)
    sigD += -0.5*einsum('klcd,bdlk,acji->abij', I.oovv, T2, RD)
    sigD += 0.5*einsum('klcd,adlk,bcji->abij', I.oovv, T2, RD)
    sigD += -1.0*einsum('klic,cj,bk,al->abij', I.ooov, T1, T1, RS)
    sigD += 1.0*einsum('klic,cj,ak,bl->abij', I.ooov, T1, T1, RS)
    sigD += -1.0*einsum('klic,bk,al,cj->abij', I.ooov, T1, T1, RS)
    sigD += 1.0*einsum('kljc,ci,bk,al->abij', I.ooov, T1, T1, RS)
    sigD += -1.0*einsum('kljc,ci,ak,bl->abij', I.ooov, T1, T1, RS)
    sigD += 1.0*einsum('kljc,bk,al,ci->abij', I.ooov, T1, T1, RS)
    sigD += -1.0*einsum('bkcd,di,cj,ak->abij', I.vovv, T1, T1, RS)
    sigD += 1.0*einsum('akcd,di,cj,bk->abij', I.vovv, T1, T1, RS)
    sigD += -1.0*einsum('bkcd,di,ak,cj->abij', I.vovv, T1, T1, RS)
    sigD += 1.0*einsum('akcd,di,bk,cj->abij', I.vovv, T1, T1, RS)
    sigD += 1.0*einsum('bkcd,dj,ak,ci->abij', I.vovv, T1, T1, RS)
    sigD += -1.0*einsum('akcd,dj,bk,ci->abij', I.vovv, T1, T1, RS)
    sigD += 1.0*einsum('Ikc,ci,bk,Iaj->abij', g.ov, T1, T1, RS1)
    sigD += -1.0*einsum('Ikc,ci,ak,Ibj->abij', g.ov, T1, T1, RS1)
    sigD += -1.0*einsum('Ikc,cj,bk,Iai->abij', g.ov, T1, T1, RS1)
    sigD += 1.0*einsum('Ikc,cj,ak,Ibi->abij', g.ov, T1, T1, RS1)
    sigD += 1.0*einsum('Ikc,ci,bakj,I->abij', g.ov, T1, T2, R1)
    sigD += -1.0*einsum('Ikc,cj,baki,I->abij', g.ov, T1, T2, R1)
    sigD += 1.0*einsum('Ikc,bk,acji,I->abij', g.ov, T1, T2, R1)
    sigD += -1.0*einsum('Ikc,ak,bcji,I->abij', g.ov, T1, T2, R1)
    sigD += 1.0*einsum('Ikc,ci,I,bakj->abij', g.ov, T1, S1, RD)
    sigD += -1.0*einsum('Ikc,cj,I,baki->abij', g.ov, T1, S1, RD)
    sigD += 1.0*einsum('Ikc,bk,I,acji->abij', g.ov, T1, S1, RD)
    sigD += -1.0*einsum('Ikc,ak,I,bcji->abij', g.ov, T1, S1, RD)
    sigD += -1.0*einsum('Ikc,ci,Ibj,ak->abij', g.ov, T1, U11, RS)
    sigD += 1.0*einsum('Ikc,ci,Iaj,bk->abij', g.ov, T1, U11, RS)
    sigD += 1.0*einsum('Ikc,cj,Ibi,ak->abij', g.ov, T1, U11, RS)
    sigD += -1.0*einsum('Ikc,cj,Iai,bk->abij', g.ov, T1, U11, RS)
    sigD += -1.0*einsum('Ikc,bk,Iai,cj->abij', g.ov, T1, U11, RS)
    sigD += 1.0*einsum('Ikc,ak,Ibi,cj->abij', g.ov, T1, U11, RS)
    sigD += 1.0*einsum('Ikc,bk,Iaj,ci->abij', g.ov, T1, U11, RS)
    sigD += -1.0*einsum('Ikc,ak,Ibj,ci->abij', g.ov, T1, U11, RS)
    sigD += -1.0*einsum('Ikc,bcji,I,ak->abij', g.ov, T2, S1, RS)
    sigD += 1.0*einsum('Ikc,acji,I,bk->abij', g.ov, T2, S1, RS)
    sigD += -1.0*einsum('Ikc,baki,I,cj->abij', g.ov, T2, S1, RS)
    sigD += 1.0*einsum('Ikc,bakj,I,ci->abij', g.ov, T2, S1, RS)
    sigD += -0.5*einsum('klcd,di,cj,balk->abij', I.oovv, T1, T1, RD)
    sigD += 1.0*einsum('klcd,di,bk,aclj->abij', I.oovv, T1, T1, RD)
    sigD += -1.0*einsum('klcd,di,ak,bclj->abij', I.oovv, T1, T1, RD)
    sigD += 1.0*einsum('klcd,di,ck,balj->abij', I.oovv, T1, T1, RD)
    sigD += -1.0*einsum('klcd,dj,bk,acli->abij', I.oovv, T1, T1, RD)
    sigD += 1.0*einsum('klcd,dj,ak,bcli->abij', I.oovv, T1, T1, RD)
    sigD += -1.0*einsum('klcd,dj,ck,bali->abij', I.oovv, T1, T1, RD)
    sigD += -0.5*einsum('klcd,bk,al,dcji->abij', I.oovv, T1, T1, RD)
    sigD += 1.0*einsum('klcd,bk,dl,acji->abij', I.oovv, T1, T1, RD)
    sigD += -1.0*einsum('klcd,ak,dl,bcji->abij', I.oovv, T1, T1, RD)
    sigD += -1.0*einsum('klcd,di,bakj,cl->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,di,bckj,al->abij', I.oovv, T1, T2, RS)
    sigD += -1.0*einsum('klcd,di,ackj,bl->abij', I.oovv, T1, T2, RS)
    sigD += -0.5*einsum('klcd,di,balk,cj->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,dj,baki,cl->abij', I.oovv, T1, T2, RS)
    sigD += -1.0*einsum('klcd,dj,bcki,al->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,dj,acki,bl->abij', I.oovv, T1, T2, RS)
    sigD += -1.0*einsum('klcd,bk,adji,cl->abij', I.oovv, T1, T2, RS)
    sigD += -0.5*einsum('klcd,bk,dcji,al->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,ak,bdji,cl->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,dk,bcji,al->abij', I.oovv, T1, T2, RS)
    sigD += 0.5*einsum('klcd,ak,dcji,bl->abij', I.oovv, T1, T2, RS)
    sigD += -1.0*einsum('klcd,dk,acji,bl->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,bk,adli,cj->abij', I.oovv, T1, T2, RS)
    sigD += -1.0*einsum('klcd,ak,bdli,cj->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,dk,bali,cj->abij', I.oovv, T1, T2, RS)
    sigD += 0.5*einsum('klcd,dj,balk,ci->abij', I.oovv, T1, T2, RS)
    sigD += -1.0*einsum('klcd,bk,adlj,ci->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,ak,bdlj,ci->abij', I.oovv, T1, T2, RS)
    sigD += -1.0*einsum('klcd,dk,balj,ci->abij', I.oovv, T1, T2, RS)
    sigD += 1.0*einsum('klcd,di,cj,bk,al->abij', I.oovv, T1, T1, T1, RS)
    sigD += -1.0*einsum('klcd,di,cj,ak,bl->abij', I.oovv, T1, T1, T1, RS)
    sigD += 1.0*einsum('klcd,di,bk,al,cj->abij', I.oovv, T1, T1, T1, RS)
    sigD += -1.0*einsum('klcd,dj,bk,al,ci->abij', I.oovv, T1, T1, T1, RS)

    sig1 += 1.0*einsum('I,I->I', w, R1)
    sig1 += 1.0*einsum('ia,Iai->I', F.ov, RS1)
    sig1 += 1.0*einsum('Iia,ai->I', h.ov, RS)
    sig1 += 1.0*einsum('Jia,J,Iai->I', g.ov, S1, RS1)
    sig1 += 1.0*einsum('Jia,Iai,J->I', g.ov, U11, R1)
    sig1 += -1.0*einsum('ijab,bi,Iaj->I', I.oovv, T1, RS1)
    sig1 += -1.0*einsum('ijab,Ibi,aj->I', I.oovv, U11, RS)

    sigS1 += -1.0*einsum('ji,Iaj->Iai', F.oo, RS1)
    sigS1 += 1.0*einsum('ab,Ibi->Iai', F.vv, RS1)
    sigS1 += 1.0*einsum('I,Iai->Iai', w, RS1)
    sigS1 += 1.0*einsum('I,I,ai->Iai', w, S1, RS)  # added by YZ
    sigS1 += -1.0*einsum('Iji,aj->Iai', h.oo, RS)
    sigS1 += 1.0*einsum('Iab,bi->Iai', h.vv, RS)
    sigS1 += -1.0*einsum('ajbi,Ibj->Iai', I.vovo, RS1)
    sigS1 += -1.0*einsum('Ijb,abji->Iai', h.ov, RD)
    sigS1 += -1.0*einsum('jb,bi,Iaj->Iai', F.ov, T1, RS1)
    sigS1 += -1.0*einsum('jb,aj,Ibi->Iai', F.ov, T1, RS1)
    sigS1 += -1.0*einsum('jb,Ibi,aj->Iai', F.ov, U11, RS)
    sigS1 += -1.0*einsum('jb,Iaj,bi->Iai', F.ov, U11, RS)
    sigS1 += -1.0*einsum('Jji,J,Iaj->Iai', g.oo, S1, RS1)
    sigS1 += -1.0*einsum('Jji,Iaj,J->Iai', g.oo, U11, R1)
    sigS1 += -1.0*einsum('Ijb,bi,aj->Iai', h.ov, T1, RS)
    sigS1 += -1.0*einsum('Ijb,aj,bi->Iai', h.ov, T1, RS)
    sigS1 += 1.0*einsum('Jab,J,Ibi->Iai', g.vv, S1, RS1)
    sigS1 += 1.0*einsum('Jab,Ibi,J->Iai', g.vv, U11, R1)
    sigS1 += -1.0*einsum('jkib,aj,Ibk->Iai', I.ooov, T1, RS1)
    sigS1 += 1.0*einsum('jkib,bj,Iak->Iai', I.ooov, T1, RS1)
    sigS1 += -1.0*einsum('jkib,Iaj,bk->Iai', I.ooov, U11, RS)
    sigS1 += 1.0*einsum('jkib,Ibj,ak->Iai', I.ooov, U11, RS)
    sigS1 += -1.0*einsum('ajbc,ci,Ibj->Iai', I.vovv, T1, RS1)
    sigS1 += 1.0*einsum('ajbc,cj,Ibi->Iai', I.vovv, T1, RS1)
    sigS1 += -1.0*einsum('ajbc,Ici,bj->Iai', I.vovv, U11, RS)
    sigS1 += 1.0*einsum('ajbc,Icj,bi->Iai', I.vovv, U11, RS)
    sigS1 += -1.0*einsum('Jjb,Ibi,Jaj->Iai', g.ov, U11, RS1)
    sigS1 += -1.0*einsum('Jjb,Iaj,Jbi->Iai', g.ov, U11, RS1)
    sigS1 += 1.0*einsum('Jjb,Ibj,Jai->Iai', g.ov, U11, RS1)
    sigS1 += 1.0*einsum('Jjb,Jai,Ibj->Iai', g.ov, U11, RS1)
    sigS1 += -1.0*einsum('Jjb,Jbi,Iaj->Iai', g.ov, U11, RS1)
    sigS1 += -1.0*einsum('Jjb,Jaj,Ibi->Iai', g.ov, U11, RS1)
    sigS1 += 1.0*einsum('jkbc,acji,Ibk->Iai', I.oovv, T2, RS1)
    sigS1 += 0.5*einsum('jkbc,cbji,Iak->Iai', I.oovv, T2, RS1)
    sigS1 += 0.5*einsum('jkbc,ackj,Ibi->Iai', I.oovv, T2, RS1)
    sigS1 += -0.5*einsum('jkbc,Ici,abkj->Iai', I.oovv, U11, RD)
    sigS1 += -0.5*einsum('jkbc,Iaj,cbki->Iai', I.oovv, U11, RD)
    sigS1 += 1.0*einsum('jkbc,Icj,abki->Iai', I.oovv, U11, RD)
    sigS1 += -1.0*einsum('Jjb,bi,J,Iaj->Iai', g.ov, T1, S1, RS1)
    sigS1 += -1.0*einsum('Jjb,aj,J,Ibi->Iai', g.ov, T1, S1, RS1)
    sigS1 += -1.0*einsum('Jjb,bi,Iaj,J->Iai', g.ov, T1, U11, R1)
    sigS1 += -1.0*einsum('Jjb,aj,Ibi,J->Iai', g.ov, T1, U11, R1)
    sigS1 += -1.0*einsum('Jjb,J,Ibi,aj->Iai', g.ov, S1, U11, RS)
    sigS1 += -1.0*einsum('Jjb,J,Iaj,bi->Iai', g.ov, S1, U11, RS)
    sigS1 += 1.0*einsum('jkbc,ci,aj,Ibk->Iai', I.oovv, T1, T1, RS1)
    sigS1 += -1.0*einsum('jkbc,ci,bj,Iak->Iai', I.oovv, T1, T1, RS1)
    sigS1 += -1.0*einsum('jkbc,aj,ck,Ibi->Iai', I.oovv, T1, T1, RS1)
    sigS1 += 1.0*einsum('jkbc,ci,Iaj,bk->Iai', I.oovv, T1, U11, RS)
    sigS1 += -1.0*einsum('jkbc,ci,Ibj,ak->Iai', I.oovv, T1, U11, RS)
    sigS1 += 1.0*einsum('jkbc,aj,Ici,bk->Iai', I.oovv, T1, U11, RS)
    sigS1 += 1.0*einsum('jkbc,cj,Ibi,ak->Iai', I.oovv, T1, U11, RS)
    sigS1 += -1.0*einsum('jkbc,aj,Ick,bi->Iai', I.oovv, T1, U11, RS)
    sigS1 += 1.0*einsum('jkbc,cj,Iak,bi->Iai', I.oovv, T1, U11, RS)
    # end of the copy

    np = w.shape[0]
    w2d = numpy.zeros((np,np))
    for k in range(np):
        w2d[k,k] = w[k]

    # here, we only need to add the difference (compared to nfock==1)
    # Note: the sign terms are wrong, more terms should appear, is re-generating the code.
    if nfock1 > 1:
        # add nfock == 2 term
        sig2 = sign[1]

        sig1 += 1.0*einsum('Jia,IJ,ai->I', g.ov, S2, RS)
        sig1 += 1.0*einsum('Jia,ai,IJ->I', g.ov, T1, R2)
        
        sig2 += 1.0*einsum('IK,JK->IJ', w2d, R2)
        sig2 += 1.0*einsum('JK,IK->IJ', w2d, R2)
        sig2 += 1.0*einsum('IK,K,J->IJ', w2d, S1, R1)
        sig2 += 1.0*einsum('JK,K,I->IJ', w2d, S1, R1)
        
        sig2 += 1.0*einsum('Iia,Jai->IJ', g.ov, RS1)
        sig2 += 1.0*einsum('Jia,Iai->IJ', g.ov, RS1)
        
        sig2 += 1.0*einsum('ia,Iai,J->IJ', F.ov, U11, R1)
        sig2 += 1.0*einsum('ia,Jai,I->IJ', F.ov, U11, R1)
        sig2 += 1.0*einsum('Iia,ai,J->IJ', g.ov, T1, R1)
        sig2 += 1.0*einsum('Jia,ai,I->IJ', g.ov, T1, R1)

        sig2 += 1.0*einsum('Kia,IK,Jai->IJ', g.ov, S2, RS1)
        sig2 += 1.0*einsum('Kia,JK,Iai->IJ', g.ov, S2, RS1)
        sig2 += 1.0*einsum('Kia,Iai,JK->IJ', g.ov, U11, R2)
        sig2 += 1.0*einsum('Kia,Jai,IK->IJ', g.ov, U11, R2)
        
        sig2 += 1.0*einsum('Kia,ai,IK,J->IJ', g.ov, T1, S2, R1)
        sig2 += 1.0*einsum('Kia,ai,JK,I->IJ', g.ov, T1, S2, R1)
        sig2 += 1.0*einsum('Kia,Iai,K,J->IJ', g.ov, U11, S1, R1)
        sig2 += 1.0*einsum('Kia,Jai,K,I->IJ', g.ov, U11, S1, R1)
        
        sig2 += -1.0*einsum('ijab,Ibi,Jaj->IJ', I.oovv, U11, RS1)
        sig2 += -1.0*einsum('ijab,Jbi,Iaj->IJ', I.oovv, U11, RS1)
        sig2 += -1.0*einsum('ijab,bi,Iaj,J->IJ', I.oovv, T1, U11, R1)
        sig2 += -1.0*einsum('ijab,bi,Jaj,I->IJ', I.oovv, T1, U11, R1)
        
        sigS1 +=  1.0*einsum('Jai,IJ->Iai', g.vo, R2)
        sigS1 += -1.0*einsum('Jji,IJ,aj->Iai', g.oo, S2, RS)
        sigS1 += -1.0*einsum('Jji,aj,IJ->Iai', g.oo, T1, R2)
        sigS1 +=  1.0*einsum('Jab,IJ,bi->Iai', g.vv, S2, RS)
        sigS1 +=  1.0*einsum('Jab,bi,IJ->Iai', g.vv, T1, R2)
        sigS1 += -1.0*einsum('Jjb,IJ,abji->Iai', g.ov, S2, RD)
        sigS1 += -1.0*einsum('Jjb,abji,IJ->Iai', g.ov, T2, R2)
        
        sigS1 += -1.0*einsum('Jjb,aj,IJ,bi->Iai', g.ov, T1, S2, RS)
        sigS1 += -1.0*einsum('Jjb,bi,IJ,aj->Iai', g.ov, T1, S2, RS)
        sigS1 += -1.0*einsum('Jjb,bi,aj,IJ->Iai', g.ov, T1, T1, R2)
        sigS1 +=  1.0*einsum('Jjb,bj,IJ,ai->Iai', g.ov, T1, S2, RS)


    if nfock1 > 2:
        # add nfock == 3 term
        sig3 = sign[2]

        sig2 += 0.33333333333333333*einsum('Kia,ai,IJK->IJ', g.ov, T1, R3)
        sig2 += 0.33333333333333333*einsum('Kia,ai,IKJ->IJ', g.ov, T1, R3)
        sig2 += 0.16666666666666666*einsum('Kia,ai,JKI->IJ', g.ov, T1, R3)
        sig2 += 0.16666666666666666*einsum('Kia,ai,KJI->IJ', g.ov, T1, R3)
        sig2 += 0.33333333333333333*einsum('Kia,IJK,ai->IJ', g.ov, S3, RS)
        sig2 += 0.33333333333333333*einsum('Kia,IKJ,ai->IJ', g.ov, S3, RS)
        sig2 += 0.16666666666666666*einsum('Kia,JKI,ai->IJ', g.ov, S3, RS)
        sig2 += 0.16666666666666666*einsum('Kia,KJI,ai->IJ', g.ov, S3, RS)
        
        sig3 += 0.33333333333333333*einsum('IL,JKL->IJK', w2d, R3)
        sig3 += 0.33333333333333333*einsum('IL,JLK->IJK', w2d, R3)
        sig3 += 0.16666666666666666*einsum('IL,KLJ->IJK', w2d, R3)
        sig3 += 0.16666666666666666*einsum('IL,LKJ->IJK', w2d, R3)
        sig3 += 0.33333333333333333*einsum('JL,IKL->IJK', w2d, R3)
        sig3 += 0.33333333333333333*einsum('JL,ILK->IJK', w2d, R3)
        sig3 += 0.16666666666666666*einsum('JL,KLI->IJK', w2d, R3)
        sig3 += 0.16666666666666666*einsum('JL,LKI->IJK', w2d, R3)
        sig3 += 0.33333333333333333*einsum('KL,IJL->IJK', w2d, R3)
        sig3 += 0.33333333333333333*einsum('KL,ILJ->IJK', w2d, R3)
        sig3 += 0.16666666666666666*einsum('KL,JLI->IJK', w2d, R3)
        sig3 += 0.16666666666666666*einsum('KL,LJI->IJK', w2d, R3)
        
        sig3 += 1.0*einsum('IL,L,JK->IJK', w2d, S1, R2)
        sig3 += 1.0*einsum('IL,JL,K->IJK', w2d, S2, R1)
        sig3 += 1.0*einsum('IL,KL,J->IJK', w2d, S2, R1)
        sig3 += 1.0*einsum('JL,L,IK->IJK', w2d, S1, R2)
        sig3 += 1.0*einsum('JL,IL,K->IJK', w2d, S2, R1)
        sig3 += 1.0*einsum('JL,KL,I->IJK', w2d, S2, R1)
        sig3 += 1.0*einsum('KL,L,IJ->IJK', w2d, S1, R2)
        sig3 += 1.0*einsum('KL,IL,J->IJK', w2d, S2, R1)
        sig3 += 1.0*einsum('KL,JL,I->IJK', w2d, S2, R1)

        sig3 += 1.0*einsum('ia,Iai,JK->IJK', F.ov, U11, R2)
        sig3 += 1.0*einsum('ia,Jai,IK->IJK', F.ov, U11, R2)
        sig3 += 1.0*einsum('ia,Kai,IJ->IJK', F.ov, U11, R2)
        sig3 += 1.0*einsum('Iia,ai,JK->IJK', g.ov, T1, R2)
        sig3 += 1.0*einsum('Jia,ai,IK->IJK', g.ov, T1, R2)
        sig3 += 1.0*einsum('Kia,ai,IJ->IJK', g.ov, T1, R2)
        sig3 += 1.0*einsum('Iia,Jai,K->IJK', g.ov, U11, R1)
        sig3 += 1.0*einsum('Iia,Kai,J->IJK', g.ov, U11, R1)
        sig3 += 1.0*einsum('Jia,Iai,K->IJK', g.ov, U11, R1)
        sig3 += 1.0*einsum('Jia,Kai,I->IJK', g.ov, U11, R1)
        sig3 += 1.0*einsum('Kia,Iai,J->IJK', g.ov, U11, R1)
        sig3 += 1.0*einsum('Kia,Jai,I->IJK', g.ov, U11, R1)
        
        sig3 += 0.33333333333333333*einsum('Lia,IJL,Kai->IJK', g.ov, S3, RS1)
        sig3 += 0.33333333333333333*einsum('Lia,IKL,Jai->IJK', g.ov, S3, RS1)
        sig3 += 0.33333333333333333*einsum('Lia,ILJ,Kai->IJK', g.ov, S3, RS1)
        sig3 += 0.33333333333333333*einsum('Lia,ILK,Jai->IJK', g.ov, S3, RS1)
        sig3 += 0.33333333333333333*einsum('Lia,JKL,Iai->IJK', g.ov, S3, RS1)
        sig3 += 0.16666666666666666*einsum('Lia,JLI,Kai->IJK', g.ov, S3, RS1)
        sig3 += 0.33333333333333333*einsum('Lia,JLK,Iai->IJK', g.ov, S3, RS1)
        sig3 += 0.16666666666666666*einsum('Lia,KLI,Jai->IJK', g.ov, S3, RS1)
        sig3 += 0.16666666666666666*einsum('Lia,KLJ,Iai->IJK', g.ov, S3, RS1)
        sig3 += 0.16666666666666666*einsum('Lia,LJI,Kai->IJK', g.ov, S3, RS1)
        sig3 += 0.16666666666666666*einsum('Lia,LKI,Jai->IJK', g.ov, S3, RS1)
        sig3 += 0.16666666666666666*einsum('Lia,LKJ,Iai->IJK', g.ov, S3, RS1)

        sig3 += 0.33333333333333333*einsum('Lia,Iai,JKL->IJK', g.ov, U11, R3)
        sig3 += 0.33333333333333333*einsum('Lia,Iai,JLK->IJK', g.ov, U11, R3)
        sig3 += 0.16666666666666666*einsum('Lia,Iai,KLJ->IJK', g.ov, U11, R3)
        sig3 += 0.16666666666666666*einsum('Lia,Iai,LKJ->IJK', g.ov, U11, R3)
        sig3 += 0.33333333333333333*einsum('Lia,Jai,IKL->IJK', g.ov, U11, R3)
        sig3 += 0.33333333333333333*einsum('Lia,Jai,ILK->IJK', g.ov, U11, R3)
        sig3 += 0.16666666666666666*einsum('Lia,Jai,KLI->IJK', g.ov, U11, R3)
        sig3 += 0.16666666666666666*einsum('Lia,Jai,LKI->IJK', g.ov, U11, R3)
        sig3 += 0.33333333333333333*einsum('Lia,Kai,IJL->IJK', g.ov, U11, R3)
        sig3 += 0.33333333333333333*einsum('Lia,Kai,ILJ->IJK', g.ov, U11, R3)
        sig3 += 0.16666666666666666*einsum('Lia,Kai,JLI->IJK', g.ov, U11, R3)
        sig3 += 0.16666666666666666*einsum('Lia,Kai,LJI->IJK', g.ov, U11, R3)

        sig3 += 1.0*einsum('Lia,ai,IL,JK->IJK', g.ov, T1, S2, R2)
        sig3 += 1.0*einsum('Lia,ai,JL,IK->IJK', g.ov, T1, S2, R2)
        sig3 += 1.0*einsum('Lia,ai,KL,IJ->IJK', g.ov, T1, S2, R2)

        sig3 += 0.33333333333333333*einsum('Lia,ai,IJL,K->IJK', g.ov, T1, S3, R1)
        sig3 += 0.33333333333333333*einsum('Lia,ai,IKL,J->IJK', g.ov, T1, S3, R1)
        sig3 += 0.33333333333333333*einsum('Lia,ai,ILJ,K->IJK', g.ov, T1, S3, R1)
        sig3 += 0.33333333333333333*einsum('Lia,ai,ILK,J->IJK', g.ov, T1, S3, R1)
        sig3 += 0.33333333333333333*einsum('Lia,ai,JKL,I->IJK', g.ov, T1, S3, R1)
        sig3 += 0.16666666666666666*einsum('Lia,ai,JLI,K->IJK', g.ov, T1, S3, R1)
        sig3 += 0.33333333333333333*einsum('Lia,ai,JLK,I->IJK', g.ov, T1, S3, R1)
        sig3 += 0.16666666666666666*einsum('Lia,ai,KLI,J->IJK', g.ov, T1, S3, R1)
        sig3 += 0.16666666666666666*einsum('Lia,ai,KLJ,I->IJK', g.ov, T1, S3, R1)
        sig3 += 0.16666666666666666*einsum('Lia,ai,LJI,K->IJK', g.ov, T1, S3, R1)
        sig3 += 0.16666666666666666*einsum('Lia,ai,LKI,J->IJK', g.ov, T1, S3, R1)
        sig3 += 0.16666666666666666*einsum('Lia,ai,LKJ,I->IJK', g.ov, T1, S3, R1)

        sig3 += 1.0*einsum('Lia,Iai,L,JK->IJK', g.ov, U11, S1, R2)
        sig3 += 1.0*einsum('Lia,Jai,L,IK->IJK', g.ov, U11, S1, R2)
        sig3 += 1.0*einsum('Lia,Kai,L,IJ->IJK', g.ov, U11, S1, R2)
        sig3 += 1.0*einsum('Lia,Iai,JL,K->IJK', g.ov, U11, S2, R1)
        sig3 += 1.0*einsum('Lia,Iai,KL,J->IJK', g.ov, U11, S2, R1)
        sig3 += 1.0*einsum('Lia,Jai,IL,K->IJK', g.ov, U11, S2, R1)
        sig3 += 1.0*einsum('Lia,Jai,KL,I->IJK', g.ov, U11, S2, R1)
        sig3 += 1.0*einsum('Lia,Kai,IL,J->IJK', g.ov, U11, S2, R1)
        sig3 += 1.0*einsum('Lia,Kai,JL,I->IJK', g.ov, U11, S2, R1)

        sig3 += -1.0*einsum('ijab,bi,Iaj,JK->IJK', I.oovv, T1, U11, R2)
        sig3 += -1.0*einsum('ijab,bi,Jaj,IK->IJK', I.oovv, T1, U11, R2)
        sig3 += -1.0*einsum('ijab,bi,Kaj,IJ->IJK', I.oovv, T1, U11, R2)
        sig3 += -1.0*einsum('ijab,Ibi,Jaj,K->IJK', I.oovv, U11, U11, R1)
        sig3 += -1.0*einsum('ijab,Ibi,Kaj,J->IJK', I.oovv, U11, U11, R1)
        sig3 += -1.0*einsum('ijab,Jbi,Kaj,I->IJK', I.oovv, U11, U11, R1)


    if nfock1 > 3:
        # add nfock == 4 term
        sig4 = sign[3]

        sig3 += 0.08333333333333333*einsum('Lia,ai,IJKL->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,IJLK->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,IKJL->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,IKLJ->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,ILJK->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,ILKJ->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,JKIL->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,JLIK->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,KJIL->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,KLIJ->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,LJIK->IJK', g.ov, T1, R4)
        sig3 += 0.08333333333333333*einsum('Lia,ai,LKIJ->IJK', g.ov, T1, R4)
        
        sig3 += 0.08333333333333333*einsum('Lia,IJKL,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,IJLK,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,IKJL,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,IKLJ,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,ILJK,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,ILKJ,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,JKIL,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,JLIK,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,KJIL,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,KLIJ,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,LJIK,ai->IJK', g.ov, S4, RS)
        sig3 += 0.08333333333333333*einsum('Lia,LKIJ,ai->IJK', g.ov, S4, RS)
       
        sig4 += 0.08333333333333333*einsum('IM,JKLM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,JKML->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,JLKM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,JLMK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,JMKL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,JMLK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,KLJM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,KMJL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,LKJM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,LMJK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,MKJL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('IM,MLJK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,IKLM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,IKML->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,ILKM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,ILMK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,IMKL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,IMLK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,KLIM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,KMIL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,LKIM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,LMIK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,MKIL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('JM,MLIK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,IJLM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,IJML->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,ILJM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,ILMJ->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,IMJL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,IMLJ->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,JLIM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,JMIL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,LJIM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,LMIJ->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,MJIL->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('KM,MLIJ->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,IJKM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,IJMK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,IKJM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,IKMJ->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,IMJK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,IMKJ->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,JKIM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,JMIK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,KJIM->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,KMIJ->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,MJIK->IJKL', w2d, R4)
        sig4 += 0.08333333333333333*einsum('LM,MKIJ->IJKL', w2d, R4)
        
        sig4 += 1.0*einsum('IM,JM,KL->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('IM,KM,JL->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('IM,LM,JK->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('JM,IM,KL->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('JM,KM,IL->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('JM,LM,IK->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('KM,IM,JL->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('KM,JM,IL->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('KM,LM,IJ->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('LM,IM,JK->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('LM,JM,IK->IJKL', w2d, S2, R2)
        sig4 += 1.0*einsum('LM,KM,IJ->IJKL', w2d, S2, R2)
        
        sig4 += 0.33333333333333333*einsum('IM,M,JKL->IJKL', w2d, S1, R3)
        sig4 += 0.33333333333333333*einsum('IM,M,JLK->IJKL', w2d, S1, R3)
        sig4 += 0.16666666666666666*einsum('IM,M,KLJ->IJKL', w2d, S1, R3)
        sig4 += 0.16666666666666666*einsum('IM,M,LKJ->IJKL', w2d, S1, R3)
        sig4 += 0.33333333333333333*einsum('IM,JKM,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('IM,JLM,K->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('IM,JMK,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('IM,JML,K->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('IM,KLM,J->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('IM,KMJ,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('IM,KML,J->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('IM,LMJ,K->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('IM,LMK,J->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('IM,MKJ,L->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('IM,MLJ,K->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('IM,MLK,J->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('JM,M,IKL->IJKL', w2d, S1, R3)
        sig4 += 0.33333333333333333*einsum('JM,M,ILK->IJKL', w2d, S1, R3)
        sig4 += 0.16666666666666666*einsum('JM,M,KLI->IJKL', w2d, S1, R3)
        sig4 += 0.16666666666666666*einsum('JM,M,LKI->IJKL', w2d, S1, R3)
        sig4 += 0.33333333333333333*einsum('JM,IKM,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('JM,ILM,K->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('JM,IMK,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('JM,IML,K->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('JM,KLM,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('JM,KMI,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('JM,KML,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('JM,LMI,K->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('JM,LMK,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('JM,MKI,L->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('JM,MLI,K->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('JM,MLK,I->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('KM,M,IJL->IJKL', w2d, S1, R3)
        sig4 += 0.33333333333333333*einsum('KM,M,ILJ->IJKL', w2d, S1, R3)
        sig4 += 0.16666666666666666*einsum('KM,M,JLI->IJKL', w2d, S1, R3)
        sig4 += 0.16666666666666666*einsum('KM,M,LJI->IJKL', w2d, S1, R3)
        sig4 += 0.33333333333333333*einsum('KM,IJM,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('KM,ILM,J->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('KM,IMJ,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('KM,IML,J->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('KM,JLM,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('KM,JMI,L->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('KM,JML,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('KM,LMI,J->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('KM,LMJ,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('KM,MJI,L->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('KM,MLI,J->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('KM,MLJ,I->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('LM,M,IJK->IJKL', w2d, S1, R3)
        sig4 += 0.33333333333333333*einsum('LM,M,IKJ->IJKL', w2d, S1, R3)
        sig4 += 0.16666666666666666*einsum('LM,M,JKI->IJKL', w2d, S1, R3)
        sig4 += 0.16666666666666666*einsum('LM,M,KJI->IJKL', w2d, S1, R3)
        sig4 += 0.33333333333333333*einsum('LM,IJM,K->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('LM,IKM,J->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('LM,IMJ,K->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('LM,IMK,J->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('LM,JKM,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('LM,JMI,K->IJKL', w2d, S3, R1)
        sig4 += 0.33333333333333333*einsum('LM,JMK,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('LM,KMI,J->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('LM,KMJ,I->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('LM,MJI,K->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('LM,MKI,J->IJKL', w2d, S3, R1)
        sig4 += 0.16666666666666666*einsum('LM,MKJ,I->IJKL', w2d, S3, R1)

        sig4 += 0.33333333333333333*einsum('ia,Iai,JKL->IJKL', F.ov, U11, R3)
        sig4 += 0.33333333333333333*einsum('ia,Iai,JLK->IJKL', F.ov, U11, R3)
        sig4 += 0.16666666666666666*einsum('ia,Iai,KLJ->IJKL', F.ov, U11, R3)
        sig4 += 0.16666666666666666*einsum('ia,Iai,LKJ->IJKL', F.ov, U11, R3)
        sig4 += 0.33333333333333333*einsum('ia,Jai,IKL->IJKL', F.ov, U11, R3)
        sig4 += 0.33333333333333333*einsum('ia,Jai,ILK->IJKL', F.ov, U11, R3)
        sig4 += 0.16666666666666666*einsum('ia,Jai,KLI->IJKL', F.ov, U11, R3)
        sig4 += 0.16666666666666666*einsum('ia,Jai,LKI->IJKL', F.ov, U11, R3)
        sig4 += 0.33333333333333333*einsum('ia,Kai,IJL->IJKL', F.ov, U11, R3)
        sig4 += 0.33333333333333333*einsum('ia,Kai,ILJ->IJKL', F.ov, U11, R3)
        sig4 += 0.16666666666666666*einsum('ia,Kai,JLI->IJKL', F.ov, U11, R3)
        sig4 += 0.16666666666666666*einsum('ia,Kai,LJI->IJKL', F.ov, U11, R3)
        sig4 += 0.33333333333333333*einsum('ia,Lai,IJK->IJKL', F.ov, U11, R3)
        sig4 += 0.33333333333333333*einsum('ia,Lai,IKJ->IJKL', F.ov, U11, R3)
        sig4 += 0.16666666666666666*einsum('ia,Lai,JKI->IJKL', F.ov, U11, R3)
        sig4 += 0.16666666666666666*einsum('ia,Lai,KJI->IJKL', F.ov, U11, R3)
        
        sig4 += 0.33333333333333333*einsum('Iia,ai,JKL->IJKL', g.ov, T1, R3)
        sig4 += 0.33333333333333333*einsum('Iia,ai,JLK->IJKL', g.ov, T1, R3)
        sig4 += 0.16666666666666666*einsum('Iia,ai,KLJ->IJKL', g.ov, T1, R3)
        sig4 += 0.16666666666666666*einsum('Iia,ai,LKJ->IJKL', g.ov, T1, R3)
        sig4 += 0.33333333333333333*einsum('Jia,ai,IKL->IJKL', g.ov, T1, R3)
        sig4 += 0.33333333333333333*einsum('Jia,ai,ILK->IJKL', g.ov, T1, R3)
        sig4 += 0.16666666666666666*einsum('Jia,ai,KLI->IJKL', g.ov, T1, R3)
        sig4 += 0.16666666666666666*einsum('Jia,ai,LKI->IJKL', g.ov, T1, R3)
        sig4 += 0.33333333333333333*einsum('Kia,ai,IJL->IJKL', g.ov, T1, R3)
        sig4 += 0.33333333333333333*einsum('Kia,ai,ILJ->IJKL', g.ov, T1, R3)
        sig4 += 0.16666666666666666*einsum('Kia,ai,JLI->IJKL', g.ov, T1, R3)
        sig4 += 0.16666666666666666*einsum('Kia,ai,LJI->IJKL', g.ov, T1, R3)
        sig4 += 0.33333333333333333*einsum('Lia,ai,IJK->IJKL', g.ov, T1, R3)
        sig4 += 0.33333333333333333*einsum('Lia,ai,IKJ->IJKL', g.ov, T1, R3)
        sig4 += 0.16666666666666666*einsum('Lia,ai,JKI->IJKL', g.ov, T1, R3)
        sig4 += 0.16666666666666666*einsum('Lia,ai,KJI->IJKL', g.ov, T1, R3)
        
        sig4 += 1.0*einsum('Iia,Jai,KL->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Iia,Kai,JL->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Iia,Lai,JK->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Jia,Iai,KL->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Jia,Kai,IL->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Jia,Lai,IK->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Kia,Iai,JL->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Kia,Jai,IL->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Kia,Lai,IJ->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Lia,Iai,JK->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Lia,Jai,IK->IJKL', g.ov, U11, R2)
        sig4 += 1.0*einsum('Lia,Kai,IJ->IJKL', g.ov, U11, R2)

        sig4 += 0.083333333333333333*einsum('Mia,Iai,JKLM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,JKML->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,JLKM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,JLMK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,JMKL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,JMLK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,KLJM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,KMJL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,LKJM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,LMJK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,MKJL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Iai,MLJK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,IKLM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,IKML->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,ILKM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,ILMK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,IMKL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,IMLK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,KLIM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,KMIL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,LKIM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,LMIK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,MKIL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Jai,MLIK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,IJLM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,IJML->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,ILJM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,ILMJ->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,IMJL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,IMLJ->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,JLIM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,JMIL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,LJIM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,LMIJ->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,MJIL->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Kai,MLIJ->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,IJKM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,IJMK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,IKJM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,IKMJ->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,IMJK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,IMKJ->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,JKIM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,JMIK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,KJIM->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,KMIJ->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,MJIK->IJKL', g.ov, U11, R4)
        sig4 += 0.083333333333333333*einsum('Mia,Lai,MKIJ->IJKL', g.ov, U11, R4)
        
        sig4 += 0.083333333333333333*einsum('Mia,IJKM,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IJLM,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IJMK,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IJML,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IKJM,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IKLM,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IKMJ,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IKML,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,ILJM,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,ILKM,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,ILMJ,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,ILMK,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IMJK,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IMJL,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IMKJ,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IMKL,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IMLJ,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,IMLK,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JKIM,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JKLM,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JKML,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JLIM,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JLKM,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JLMK,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JMIK,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JMIL,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JMKL,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,JMLK,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,KJIM,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,KLIM,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,KLJM,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,KMIJ,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,KMIL,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,KMJL,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,LJIM,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,LKIM,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,LKJM,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,LMIJ,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,LMIK,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,LMJK,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,MJIK,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,MJIL,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,MKIJ,Lai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,MKIL,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,MKJL,Iai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,MLIJ,Kai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,MLIK,Jai->IJKL', g.ov, S4, RS1)
        sig4 += 0.083333333333333333*einsum('Mia,MLJK,Iai->IJKL', g.ov, S4, RS1)

        sig4 += 0.33333333333333333*einsum('Mia,ai,IM,JKL->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.33333333333333333*einsum('Mia,ai,IM,JLK->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.16666666666666666*einsum('Mia,ai,IM,KLJ->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.16666666666666666*einsum('Mia,ai,IM,LKJ->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.33333333333333333*einsum('Mia,ai,JM,IKL->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.33333333333333333*einsum('Mia,ai,JM,ILK->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.16666666666666666*einsum('Mia,ai,JM,KLI->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.16666666666666666*einsum('Mia,ai,JM,LKI->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.33333333333333333*einsum('Mia,ai,KM,IJL->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.33333333333333333*einsum('Mia,ai,KM,ILJ->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.16666666666666666*einsum('Mia,ai,KM,JLI->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.16666666666666666*einsum('Mia,ai,KM,LJI->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.33333333333333333*einsum('Mia,ai,LM,IJK->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.33333333333333333*einsum('Mia,ai,LM,IKJ->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.16666666666666666*einsum('Mia,ai,LM,JKI->IJKL', g.ov, T1, S2, R3)
        sig4 += 0.16666666666666666*einsum('Mia,ai,LM,KJI->IJKL', g.ov, T1, S2, R3)

        sig4 += 0.33333333333333333*einsum('Mia,ai,IJM,KL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,IKM,JL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,ILM,JK->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,IMJ,KL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,IMK,JL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,IML,JK->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,JKM,IL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,JLM,IK->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,JMI,KL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,JMK,IL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,JML,IK->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,KLM,IJ->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,KMI,JL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,KMJ,IL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.33333333333333333*einsum('Mia,ai,KML,IJ->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,LMI,JK->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,LMJ,IK->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,LMK,IJ->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,MJI,KL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,MKI,JL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,MKJ,IL->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,MLI,JK->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,MLJ,IK->IJKL', g.ov, T1, S3, R2)
        sig4 += 0.16666666666666666*einsum('Mia,ai,MLK,IJ->IJKL', g.ov, T1, S3, R2)
        
        sig4 += 0.08333333333333333*einsum('Mia,ai,IJKM,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IJLM,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IJMK,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IJML,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IKJM,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IKLM,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IKMJ,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IKML,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,ILJM,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,ILKM,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,ILMJ,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,ILMK,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IMJK,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IMJL,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IMKJ,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IMKL,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IMLJ,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,IMLK,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JKIM,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JKLM,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JKML,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JLIM,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JLKM,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JLMK,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JMIK,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JMIL,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JMKL,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,JMLK,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,KJIM,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,KLIM,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,KLJM,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,KMIJ,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,KMIL,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,KMJL,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,LJIM,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,LKIM,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,LKJM,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,LMIJ,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,LMIK,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,LMJK,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,MJIK,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,MJIL,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,MKIJ,L->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,MKIL,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,MKJL,I->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,MLIJ,K->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,MLIK,J->IJKL', g.ov, T1, S4, R1)
        sig4 += 0.08333333333333333*einsum('Mia,ai,MLJK,I->IJKL', g.ov, T1, S4, R1)
        
        sig4 += 0.33333333333333333*einsum('Mia,Iai,M,JKL->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.33333333333333333*einsum('Mia,Iai,M,JLK->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.16666666666666666*einsum('Mia,Iai,M,KLJ->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.16666666666666666*einsum('Mia,Iai,M,LKJ->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.33333333333333333*einsum('Mia,Jai,M,IKL->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.33333333333333333*einsum('Mia,Jai,M,ILK->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.16666666666666666*einsum('Mia,Jai,M,KLI->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.16666666666666666*einsum('Mia,Jai,M,LKI->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.33333333333333333*einsum('Mia,Lai,M,IJK->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.33333333333333333*einsum('Mia,Lai,M,IKJ->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.16666666666666666*einsum('Mia,Lai,M,JKI->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.16666666666666666*einsum('Mia,Lai,M,KJI->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.33333333333333333*einsum('Mia,Kai,M,IJL->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.33333333333333333*einsum('Mia,Kai,M,ILJ->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.16666666666666666*einsum('Mia,Kai,M,JLI->IJKL', g.ov, U11, S1, R3)
        sig4 += 0.16666666666666666*einsum('Mia,Kai,M,LJI->IJKL', g.ov, U11, S1, R3)
         
        sig4 += 0.33333333333333333*einsum('Mia,Iai,JKM,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Iai,JLM,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Iai,JMK,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Iai,JML,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Iai,KLM,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Iai,KMJ,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Iai,KML,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Iai,LMJ,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Iai,LMK,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Iai,MKJ,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Iai,MLJ,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Iai,MLK,J->IJKL', g.ov, U11, S3, R1)
        
        
        sig4 += 1.0*einsum('Mia,Iai,JM,KL->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Iai,KM,JL->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Iai,LM,JK->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Jai,IM,KL->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Jai,KM,IL->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Jai,LM,IK->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Kai,IM,JL->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Kai,JM,IL->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Kai,LM,IJ->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Lai,IM,JK->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Lai,JM,IK->IJKL', g.ov, U11, S2, R2)
        sig4 += 1.0*einsum('Mia,Lai,KM,IJ->IJKL', g.ov, U11, S2, R2)
        
        sig4 += 0.33333333333333333*einsum('Mia,Jai,IKM,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Jai,ILM,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Jai,IMK,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Jai,IML,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Jai,KLM,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Jai,KMI,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Jai,KML,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Jai,LMI,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Jai,LMK,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Jai,MKI,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Jai,MLI,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Jai,MLK,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Kai,IJM,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Kai,ILM,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Kai,IMJ,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Kai,IML,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Kai,JLM,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Kai,JMI,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Kai,JML,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Kai,LMI,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Kai,LMJ,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Kai,MJI,L->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Kai,MLI,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Kai,MLJ,I->IJKL', g.ov, U11, S3, R1) 
        sig4 += 0.33333333333333333*einsum('Mia,Lai,IJM,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Lai,IKM,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Lai,IMJ,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Lai,IMK,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Lai,JKM,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Lai,JMI,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.33333333333333333*einsum('Mia,Lai,JMK,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Lai,KMI,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Lai,KMJ,I->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Lai,MJI,K->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Lai,MKI,J->IJKL', g.ov, U11, S3, R1)
        sig4 += 0.16666666666666666*einsum('Mia,Lai,MKJ,I->IJKL', g.ov, U11, S3, R1)
        
        sig4 += -0.33333333333333333*einsum('ijab,bi,Iaj,JKL->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.33333333333333333*einsum('ijab,bi,Iaj,JLK->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.16666666666666666*einsum('ijab,bi,Iaj,KLJ->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.16666666666666666*einsum('ijab,bi,Iaj,LKJ->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.33333333333333333*einsum('ijab,bi,Jaj,IKL->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.33333333333333333*einsum('ijab,bi,Jaj,ILK->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.16666666666666666*einsum('ijab,bi,Jaj,KLI->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.16666666666666666*einsum('ijab,bi,Jaj,LKI->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.33333333333333333*einsum('ijab,bi,Kaj,IJL->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.33333333333333333*einsum('ijab,bi,Kaj,ILJ->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.16666666666666666*einsum('ijab,bi,Kaj,JLI->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.16666666666666666*einsum('ijab,bi,Kaj,LJI->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.33333333333333333*einsum('ijab,bi,Laj,IJK->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.33333333333333333*einsum('ijab,bi,Laj,IKJ->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.16666666666666666*einsum('ijab,bi,Laj,JKI->IJKL', I.oovv, T1, U11, R3)
        sig4 += -0.16666666666666666*einsum('ijab,bi,Laj,KJI->IJKL', I.oovv, T1, U11, R3)
        
        sig4 += -1.0*einsum('ijab,Ibi,Jaj,KL->IJKL', I.oovv, U11, U11, R2)
        sig4 += -1.0*einsum('ijab,Ibi,Kaj,JL->IJKL', I.oovv, U11, U11, R2)
        sig4 += -1.0*einsum('ijab,Ibi,Laj,JK->IJKL', I.oovv, U11, U11, R2)
        sig4 += -1.0*einsum('ijab,Jbi,Kaj,IL->IJKL', I.oovv, U11, U11, R2)
        sig4 += -1.0*einsum('ijab,Jbi,Laj,IK->IJKL', I.oovv, U11, U11, R2)
        sig4 += -1.0*einsum('ijab,Kbi,Laj,IJ->IJKL', I.oovv, U11, U11, R2)

    return sigS, sigD, sign, sigSn
